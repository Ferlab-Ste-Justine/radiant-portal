CREATE TABLE observation_coding
(
    "id"               INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "case_id"          INTEGER REFERENCES "case" ("id")        NOT NULL,
    "patient_id"       INTEGER REFERENCES "patient" ("id")     NOT NULL,
    "observation_code" TEXT REFERENCES "observations" ("code") NOT NULL,
    "coding_system"    TEXT                                    NOT NULL,
    "code_value"       TEXT                                    NOT NULL,
    "onset_code"       TEXT REFERENCES "onsets" ("code")       NOT NULL,
    "interpretation"   TEXT REFERENCES "obs_interpretations" ("code"),
    "note"             TEXT
);

CREATE INDEX IF NOT EXISTS idx_observation_case_id ON "observation_coding" ("case_id");
CREATE INDEX IF NOT EXISTS idx_observation_patient_id ON "observation_coding" ("patient_id");