import{r as S,R as Ct}from"./index-tvICUrOf.js";import{s as se}from"./index-BNh7Aicb.js";import{a as $t,H as re,O as oe,B as _t,I as ie,b as ae}from"./query-builder-remote-CzQy3Xv-.js";const Bt=0,Kt=1,zt=2,Wt=3;var Ut=Object.prototype.hasOwnProperty;function wt(t,e){var n,s;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((s=t.length)===e.length)for(;s--&&wt(t[s],e[s]););return s===-1}if(!n||typeof t=="object"){s=0;for(n in t)if(Ut.call(t,n)&&++s&&!Ut.call(e,n)||!(n in e)||!wt(t[n],e[n]))return!1;return Object.keys(e).length===s}}return t!==t&&e!==e}const N=new WeakMap,M=()=>{},C=M(),mt=Object,a=t=>t===C,P=t=>typeof t=="function",W=(t,e)=>({...t,...e}),Jt=t=>P(t.then),ft={},ot={},yt="undefined",tt=typeof window!=yt,gt=typeof document!=yt,ce=tt&&"Deno"in window,ue=()=>tt&&typeof window.requestAnimationFrame!=yt,Gt=(t,e)=>{const n=N.get(t);return[()=>!a(e)&&t.get(e)||ft,s=>{if(!a(e)){const c=t.get(e);e in ot||(ot[e]=c),n[5](e,W(c,s),c||ft)}},n[6],()=>!a(e)&&e in ot?ot[e]:!a(e)&&t.get(e)||ft]};let Ot=!0;const le=()=>Ot,[vt,St]=tt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[M,M],fe=()=>{const t=gt&&document.visibilityState;return a(t)||t!=="hidden"},de=t=>(gt&&document.addEventListener("visibilitychange",t),vt("focus",t),()=>{gt&&document.removeEventListener("visibilitychange",t),St("focus",t)}),he=t=>{const e=()=>{Ot=!0,t()},n=()=>{Ot=!1};return vt("online",e),vt("offline",n),()=>{St("online",e),St("offline",n)}},pe={isOnline:le,isVisible:fe},Ee={initFocus:de,initReconnect:he},qt=!Ct.useId,Z=!tt||ce,Re=t=>ue()?window.requestAnimationFrame(t):setTimeout(t,1),dt=Z?S.useEffect:S.useLayoutEffect,ht=typeof navigator<"u"&&navigator.connection,Ht=!Z&&ht&&(["slow-2g","2g"].includes(ht.effectiveType)||ht.saveData),it=new WeakMap,pt=(t,e)=>mt.prototype.toString.call(t)===`[object ${e}]`;let we=0;const Tt=t=>{const e=typeof t,n=pt(t,"Date"),s=pt(t,"RegExp"),c=pt(t,"Object");let o,i;if(mt(t)===t&&!n&&!s){if(o=it.get(t),o)return o;if(o=++we+"~",it.set(t,o),Array.isArray(t)){for(o="@",i=0;i<t.length;i++)o+=Tt(t[i])+",";it.set(t,o)}if(c){o="#";const d=mt.keys(t).sort();for(;!a(i=d.pop());)a(t[i])||(o+=i+":"+Tt(t[i])+",");it.set(t,o)}}else o=n?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},bt=t=>{if(P(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?Tt(t):"",[t,e]};let me=0;const Dt=()=>++me;async function Yt(...t){const[e,n,s,c]=t,o=W({populateCache:!0,throwOnError:!0},typeof c=="boolean"?{revalidate:c}:c||{});let i=o.populateCache;const d=o.rollbackOnError;let p=o.optimisticData;const b=T=>typeof d=="function"?d(T):d!==!1,g=o.throwOnError;if(P(n)){const T=n,E=[],L=e.keys();for(const w of L)!/^\$(inf|sub)\$/.test(w)&&T(e.get(w)._k)&&E.push(w);return Promise.all(E.map(R))}return R(n);async function R(T){const[E]=bt(T);if(!E)return;const[L,w]=Gt(e,E),[at,r,et,Y]=N.get(e),F=()=>{const A=at[E];return(P(o.revalidate)?o.revalidate(L().data,T):o.revalidate!==!1)&&(delete et[E],delete Y[E],A&&A[0])?A[0](zt).then(()=>L().data):L().data};if(t.length<3)return F();let O=s,_;const H=Dt();r[E]=[H,0];const f=!a(p),k=L(),V=k.data,$=k._c,U=a($)?V:$;if(f&&(p=P(p)?p(U,V):p,w({data:p,_c:U})),P(O))try{O=O(U)}catch(A){_=A}if(O&&Jt(O))if(O=await O.catch(A=>{_=A}),H!==r[E][0]){if(_)throw _;return O}else _&&f&&b(_)&&(i=!0,w({data:U,_c:C}));if(i&&!_)if(P(i)){const A=i(O,U);w({data:A,error:C,_c:C})}else w({data:O,error:C,_c:C});if(r[E][1]=Dt(),Promise.resolve(F()).then(()=>{w({_c:C})}),_){if(g)throw _;return}return O}}const kt=(t,e)=>{for(const n in t)t[n][0]&&t[n][0](e)},ge=(t,e)=>{if(!N.has(t)){const n=W(Ee,e),s=Object.create(null),c=Yt.bind(C,t);let o=M;const i=Object.create(null),d=(g,R)=>{const T=i[g]||[];return i[g]=T,T.push(R),()=>T.splice(T.indexOf(R),1)},p=(g,R,T)=>{t.set(g,R);const E=i[g];if(E)for(const L of E)L(R,T)},b=()=>{if(!N.has(t)&&(N.set(t,[s,Object.create(null),Object.create(null),Object.create(null),c,p,d]),!Z)){const g=n.initFocus(setTimeout.bind(C,kt.bind(C,s,Bt))),R=n.initReconnect(setTimeout.bind(C,kt.bind(C,s,Kt)));o=()=>{g&&g(),R&&R(),N.delete(t)}}};return b(),[t,c,b,o]}return[t,N.get(t)[4]]},Oe=(t,e,n,s,c)=>{const o=n.errorRetryCount,i=c.retryCount,d=~~((Math.random()+.5)*(1<<(i<8?i:8)))*n.errorRetryInterval;!a(o)&&i>o||setTimeout(s,d,c)},ve=wt,[Xt,Se]=ge(new Map),Te=W({onLoadingSlow:M,onSuccess:M,onError:M,onErrorRetry:Oe,onDiscarded:M,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Ht?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Ht?5e3:3e3,compare:ve,isPaused:()=>!1,cache:Xt,mutate:Se,fallback:{}},pe),De=(t,e)=>{const n=W(t,e);if(e){const{use:s,fallback:c}=t,{use:o,fallback:i}=e;s&&o&&(n.use=s.concat(o)),c&&i&&(n.fallback=W(c,i))}return n},Ce=S.createContext({}),_e="$inf$",Qt=tt&&window.__SWR_DEVTOOLS_USE__,ye=Qt?window.__SWR_DEVTOOLS_USE__:[],be=()=>{Qt&&(window.__SWR_DEVTOOLS_REACT__=Ct)},Ae=t=>P(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],Ie=()=>W(Te,S.useContext(Ce)),Le=t=>(e,n,s)=>t(e,n&&((...o)=>{const[i]=bt(e),[,,,d]=N.get(Xt);if(i.startsWith(_e))return n(...o);const p=d[i];return a(p)?n(...o):(delete d[i],p)}),s),Ve=ye.concat(Le),Pe=t=>function(...n){const s=Ie(),[c,o,i]=Ae(n),d=De(s,i);let p=t;const{use:b}=d,g=(b||[]).concat(Ve);for(let R=g.length;R--;)p=g[R](p);return p(c,o||d.fetcher||null,d)},je=(t,e,n)=>{const s=e[t]||(e[t]=[]);return s.push(n),()=>{const c=s.indexOf(n);c>=0&&(s[c]=s[s.length-1],s.pop())}};be();const Et=Ct.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),Rt={dedupe:!0},xe=(t,e,n)=>{const{cache:s,compare:c,suspense:o,fallbackData:i,revalidateOnMount:d,revalidateIfStale:p,refreshInterval:b,refreshWhenHidden:g,refreshWhenOffline:R,keepPreviousData:T}=n,[E,L,w,at]=N.get(s),[r,et]=bt(t),Y=S.useRef(!1),F=S.useRef(!1),O=S.useRef(r),_=S.useRef(e),H=S.useRef(n),f=()=>H.current,k=()=>f().isVisible()&&f().isOnline(),[V,$,U,A]=Gt(s,r),B=S.useRef({}).current,nt=a(i)?a(n.fallback)?C:n.fallback[r]:i,It=(l,u)=>{for(const v in B){const h=v;if(h==="data"){if(!c(l[h],u[h])&&(!a(l[h])||!c(rt,u[h])))return!1}else if(u[h]!==l[h])return!1}return!0},Lt=S.useMemo(()=>{const l=!r||!e?!1:a(d)?f().isPaused()||o?!1:p!==!1:d,u=D=>{const j=W(D);return delete j._k,l?{isValidating:!0,isLoading:!0,...j}:j},v=V(),h=A(),I=u(v),J=v===h?I:u(h);let m=I;return[()=>{const D=u(V());return It(D,m)?(m.data=D.data,m.isLoading=D.isLoading,m.isValidating=D.isValidating,m.error=D.error,m):(m=D,D)},()=>J]},[s,r]),K=se.useSyncExternalStore(S.useCallback(l=>U(r,(u,v)=>{It(v,u)||l()}),[s,r]),Lt[0],Lt[1]),Vt=!Y.current,Zt=E[r]&&E[r].length>0,z=K.data,q=a(z)?nt&&Jt(nt)?Et(nt):nt:z,st=K.error,ct=S.useRef(q),rt=T?a(z)?a(ct.current)?q:ct.current:z:q,Pt=Zt&&!a(st)?!1:Vt&&!a(d)?d:f().isPaused()?!1:o?a(q)?!1:p:a(q)||p,jt=!!(r&&e&&Vt&&Pt),te=a(K.isValidating)?jt:K.isValidating,ee=a(K.isLoading)?jt:K.isLoading,X=S.useCallback(async l=>{const u=_.current;if(!r||!u||F.current||f().isPaused())return!1;let v,h,I=!0;const J=l||{},m=!w[r]||!J.dedupe,D=()=>qt?!F.current&&r===O.current&&Y.current:r===O.current,j={isValidating:!1,isLoading:!1},Nt=()=>{$(j)},Ft=()=>{const y=w[r];y&&y[1]===h&&delete w[r]},Mt={isValidating:!0};a(V().data)&&(Mt.isLoading=!0);try{if(m&&($(Mt),n.loadingTimeout&&a(V().data)&&setTimeout(()=>{I&&D()&&f().onLoadingSlow(r,n)},n.loadingTimeout),w[r]=[u(et),Dt()]),[v,h]=w[r],v=await v,m&&setTimeout(Ft,n.dedupingInterval),!w[r]||w[r][1]!==h)return m&&D()&&f().onDiscarded(r),!1;j.error=C;const y=L[r];if(!a(y)&&(h<=y[0]||h<=y[1]||y[1]===0))return Nt(),m&&D()&&f().onDiscarded(r),!1;const x=V().data;j.data=c(x,v)?x:v,m&&D()&&f().onSuccess(v,r,n)}catch(y){Ft();const x=f(),{shouldRetryOnError:ut}=x;x.isPaused()||(j.error=y,m&&D()&&(x.onError(y,r,x),(ut===!0||P(ut)&&ut(y))&&(!f().revalidateOnFocus||!f().revalidateOnReconnect||k())&&x.onErrorRetry(y,r,x,ne=>{const lt=E[r];lt&&lt[0]&&lt[0](Wt,ne)},{retryCount:(J.retryCount||0)+1,dedupe:!0})))}return I=!1,Nt(),!0},[r,s]),xt=S.useCallback((...l)=>Yt(s,O.current,...l),[]);if(dt(()=>{_.current=e,H.current=n,a(z)||(ct.current=z)}),dt(()=>{if(!r)return;const l=X.bind(C,Rt);let u=0;f().revalidateOnFocus&&(u=Date.now()+f().focusThrottleInterval);const h=je(r,E,(I,J={})=>{if(I==Bt){const m=Date.now();f().revalidateOnFocus&&m>u&&k()&&(u=m+f().focusThrottleInterval,l())}else if(I==Kt)f().revalidateOnReconnect&&k()&&l();else{if(I==zt)return X();if(I==Wt)return X(J)}});return F.current=!1,O.current=r,Y.current=!0,$({_k:et}),Pt&&(a(q)||Z?l():Re(l)),()=>{F.current=!0,h()}},[r]),dt(()=>{let l;function u(){const h=P(b)?b(V().data):b;h&&l!==-1&&(l=setTimeout(v,h))}function v(){!V().error&&(g||f().isVisible())&&(R||f().isOnline())?X(Rt).then(u):u()}return u(),()=>{l&&(clearTimeout(l),l=-1)}},[b,g,R,r]),S.useDebugValue(rt),o&&a(q)&&r){if(!qt&&Z)throw new Error("Fallback data is required when using Suspense in SSR.");_.current=e,H.current=n,F.current=!1;const l=at[r];if(!a(l)){const u=xt(l);Et(u)}if(a(st)){const u=X(Rt);a(rt)||(u.status="fulfilled",u.value=!0),Et(u)}else throw st}return{mutate:xt,get data(){return B.data=!0,rt},get error(){return B.error=!0,st},get isValidating(){return B.isValidating=!0,te},get isLoading(){return B.isLoading=!0,ee}}},qe=Pe(xe);class Ne{constructor(e={}){var n;this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.serverIndex=e.serverIndex,this.baseOptions={...e.baseOptions,headers:{...(n=e.baseOptions)==null?void 0:n.headers}},this.formDataCtor=e.formDataCtor}isJsonMime(e){const n=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(n.test(e)||e.toLowerCase()==="application/json-patch+json")}}const G=$t.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});let Q=null;G.interceptors.response.use(t=>t,async t=>{const e=t.config;if(Q)return await Q,G(e);if(t.response.status===re.Unauthorized&&!e._retry){e._retry=!0;try{return Q=$t.post("/auth/refresh-token").finally(()=>{Q=null}),await Q,G(e)}catch(n){return window.location.href="/auth/logout",Promise.reject(n)}}return Promise.reject(t)});const At=new Ne({basePath:"/api"}),He=new oe(At,_t,G);new ie(At,_t,G);new ae(At,_t,G);export{He as o,qe as u};
